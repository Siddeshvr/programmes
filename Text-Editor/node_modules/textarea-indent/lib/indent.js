"use strict";

var getHeadSpace = function getHeadSpace(_x, _x2) {
  var _again = true;

  _function: while (_again) {
    var text = _x,
        head = _x2;
    _again = false;

    if (text[0] === " ") {
      _x = text.substr(1);
      _x2 = head + " ";
      _again = true;
      continue _function;
    } else {
      return head;
    }
  }
};

exports.newlineHandler = function (event) {
  if (event.keyCode !== 13) {
    return undefined;
  }

  if (event.metaKey || event.ctrlKey || event.shiftKey) {
    return undefined;
  }

  event.preventDefault();
  var input = event.target;
  var start = input.selectionStart,
      code = input.value,
      before = code.substr(0, start),
      after = code.substr(start),
      lines = before.split("\n"),
      lastLine = lines[lines.length - 1],
      headSpace = getHeadSpace(lastLine, "");
  input.value = before + "\n" + headSpace + after;
  input.selectionStart = input.selectionEnd = start + headSpace.length + 1;
  var event = document.createEvent("Event");
  event.initEvent("change", true, true);
  input.dispatchEvent(event);
};